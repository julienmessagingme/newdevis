---
import BaseLayout from '@/layouts/BaseLayout.astro';
import AstroHeader from '@/components/astro/Header.astro';
import AstroFooter from '@/components/astro/Footer.astro';

const jsonLd = {
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": "Simulateur de valorisation des travaux immobiliers",
  "description": "Estimez l'impact de vos travaux sur la valeur de revente ou la rentabilitÃ© locative. Simulateur gratuit, sans inscription.",
  "url": "https://verifiermondevis.fr/simulateur-valorisation-travaux",
  "applicationCategory": "UtilitiesApplication",
  "operatingSystem": "Web",
  "offers": { "@type": "Offer", "price": "0", "priceCurrency": "EUR" }
};
---

<BaseLayout
  title="Simulateur de valorisation des travaux immobiliers | VerifierMonDevis.fr"
  description="Estimez l'impact de vos travaux sur la valeur de revente ou le loyer. Calcul basÃ© sur les barÃ¨mes du marchÃ© immobilier franÃ§ais. Gratuit, sans inscription."
  canonical="https://verifiermondevis.fr/simulateur-valorisation-travaux"
  ogType="article"
  jsonLd={jsonLd}
  breadcrumbs={[
    { name: "Accueil",                  url: "https://verifiermondevis.fr/" },
    { name: "Valorisation des travaux", url: "https://verifiermondevis.fr/valorisation-travaux-immobiliers" },
    { name: "Simulateur",               url: "https://verifiermondevis.fr/simulateur-valorisation-travaux" }
  ]}
>
  <div class="min-h-screen flex flex-col">
    <AstroHeader />

    <main class="flex-1">

      <!-- â•â• HERO â•â• -->
      <section class="bg-gradient-to-b from-slate-900 to-slate-800 text-white py-14 sm:py-18">
        <div class="container max-w-2xl text-center">
          <a
            href="/valorisation-travaux-immobiliers"
            class="inline-flex items-center gap-1.5 text-slate-400 hover:text-white mb-6 transition-colors text-xs"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
            </svg>
            Guide valorisation des travaux
          </a>

          <div class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-white/10 text-xs font-medium text-slate-300 mb-5">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z" />
            </svg>
            Simulateur gratuit
          </div>

          <h1 class="text-3xl sm:text-4xl font-bold leading-tight mb-4">
            Simulateur de valorisation<br class="hidden sm:block" />
            des travaux immobiliers
          </h1>
          <p class="text-slate-300 text-base sm:text-lg leading-relaxed max-w-xl mx-auto">
            Estimez l'impact de vos travaux sur la valeur de revente ou la rentabilitÃ© locative â€”
            calcul basÃ© sur les barÃ¨mes du marchÃ©, sans inscription.
          </p>
        </div>
      </section>

      <!-- â•â• SIMULATEUR â•â• -->
      <section class="py-10 sm:py-14 bg-slate-50">
        <div class="container max-w-xl">

          <!-- â”€â”€ FORMULAIRE â”€â”€ -->
          <div class="bg-white rounded-2xl border border-slate-200 shadow-md p-6 sm:p-8 mb-6">

            <p class="text-xs font-bold uppercase tracking-widest text-slate-400 mb-5">
              Renseignez votre projet
            </p>

            <!-- 1. Budget -->
            <div class="mb-5">
              <label for="budget" class="block text-sm font-semibold text-slate-700 mb-2">
                Budget travaux <span class="text-red-500">*</span>
              </label>
              <div class="relative">
                <input
                  id="budget"
                  type="number"
                  min="1000"
                  step="1000"
                  placeholder="Ex. 25 000"
                  class="w-full rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 pr-10 text-slate-900 text-base font-medium placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-primary/30 focus:border-primary transition-colors"
                />
                <span class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 font-semibold text-sm pointer-events-none">â‚¬</span>
              </div>
            </div>

            <!-- 2. Type de travaux -->
            <div class="mb-5">
              <label for="work-type" class="block text-sm font-semibold text-slate-700 mb-2">
                Type principal de travaux <span class="text-red-500">*</span>
              </label>
              <div class="relative">
                <select
                  id="work-type"
                  class="w-full appearance-none rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 pr-10 text-slate-900 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-primary/30 focus:border-primary transition-colors cursor-pointer"
                >
                  <option value="">SÃ©lectionner le type de travauxâ€¦</option>
                  <option value="extension">ğŸ—ï¸ Extension / surÃ©lÃ©vation</option>
                  <option value="renovation_complete">ğŸ  RÃ©novation complÃ¨te</option>
                  <option value="cuisine_sdb">ğŸ› Cuisine / Salle de bain</option>
                  <option value="isolation_energie">ğŸŒ¿ Isolation / RÃ©novation Ã©nergÃ©tique</option>
                  <option value="rafraichissement">ğŸ¨ RafraÃ®chissement / Peinture</option>
                </select>
                <svg xmlns="http://www.w3.org/2000/svg" class="absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400 pointer-events-none" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                </svg>
              </div>
            </div>

            <!-- 3. Objectif -->
            <div class="mb-5">
              <p class="block text-sm font-semibold text-slate-700 mb-2">
                Votre objectif <span class="text-red-500">*</span>
              </p>
              <div class="grid grid-cols-2 gap-3">
                <button
                  id="btn-revente"
                  type="button"
                  class="flex flex-col items-center gap-1.5 rounded-xl border-2 border-primary bg-primary/5 px-4 py-3.5 text-sm font-semibold text-primary transition-all"
                >
                  <span class="text-xl">ğŸ </span>
                  <span>Revente</span>
                </button>
                <button
                  id="btn-location"
                  type="button"
                  class="flex flex-col items-center gap-1.5 rounded-xl border-2 border-slate-200 bg-slate-50 px-4 py-3.5 text-sm font-semibold text-slate-500 transition-all hover:border-slate-300"
                >
                  <span class="text-xl">ğŸ”‘</span>
                  <span>Location</span>
                </button>
              </div>
            </div>

            <!-- â”€â”€ CHAMPS REVENTE (optionnel : valeur du bien) â”€â”€ -->
            <div id="revente-extra">
              <div class="mb-5">
                <label for="property-value" class="block text-sm font-semibold text-slate-700 mb-1">
                  Valeur actuelle estimÃ©e du bien
                  <span class="text-xs font-normal text-slate-400 ml-1">â€” optionnel</span>
                </label>
                <p class="text-xs text-slate-400 mb-2 leading-relaxed">
                  Si renseignÃ©e, nous calculons le gain en pourcentage de la valeur de votre bien.
                </p>
                <div class="relative">
                  <input
                    id="property-value"
                    type="number"
                    min="0"
                    step="5000"
                    placeholder="Ex. 200 000"
                    class="w-full rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 pr-10 text-slate-900 text-base font-medium placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-primary/30 focus:border-primary transition-colors"
                  />
                  <span class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 font-semibold text-sm pointer-events-none">â‚¬</span>
                </div>
              </div>
            </div>

            <!-- â”€â”€ CHAMPS LOCATION â”€â”€ -->
            <div id="location-extra" class="hidden">

              <!-- Zone de marchÃ© -->
              <div class="mb-5">
                <label for="location-zone" class="block text-sm font-semibold text-slate-700 mb-2">
                  Zone de marchÃ© <span class="text-red-500">*</span>
                </label>
                <div class="relative">
                  <select
                    id="location-zone"
                    class="w-full appearance-none rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 pr-10 text-slate-900 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-primary/30 focus:border-primary transition-colors cursor-pointer"
                  >
                    <option value="">SÃ©lectionner la zoneâ€¦</option>
                    <option value="tendue">ğŸ™ï¸ Zone tendue (Paris, Lyon, Bordeauxâ€¦)</option>
                    <option value="intermediaire">ğŸ˜ï¸ Zone intermÃ©diaire (villes moyennes)</option>
                    <option value="detendue">ğŸŒ¾ Zone dÃ©tendue (rural, faible demande)</option>
                  </select>
                  <svg xmlns="http://www.w3.org/2000/svg" class="absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400 pointer-events-none" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                  </svg>
                </div>
              </div>

              <!-- Type de bien -->
              <div class="mb-5">
                <label for="property-type" class="block text-sm font-semibold text-slate-700 mb-2">
                  Type de bien <span class="text-red-500">*</span>
                </label>
                <div class="relative">
                  <select
                    id="property-type"
                    class="w-full appearance-none rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 pr-10 text-slate-900 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-primary/30 focus:border-primary transition-colors cursor-pointer"
                  >
                    <option value="">SÃ©lectionner le type de bienâ€¦</option>
                    <option value="appartement">ğŸ¢ Appartement</option>
                    <option value="maison">ğŸ¡ Maison</option>
                  </select>
                  <svg xmlns="http://www.w3.org/2000/svg" class="absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400 pointer-events-none" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                  </svg>
                </div>
              </div>

              <!-- Surface actuelle -->
              <div class="mb-5">
                <label for="surface-actuelle" class="block text-sm font-semibold text-slate-700 mb-2">
                  Surface actuelle du bien (mÂ²) <span class="text-red-500">*</span>
                </label>
                <div class="relative">
                  <input
                    id="surface-actuelle"
                    type="number"
                    min="5"
                    step="1"
                    placeholder="Ex. 65"
                    class="w-full rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 pr-12 text-slate-900 text-base font-medium placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-primary/30 focus:border-primary transition-colors"
                  />
                  <span class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 font-semibold text-xs pointer-events-none">mÂ²</span>
                </div>
              </div>

              <!-- Surface ajoutÃ©e -->
              <div class="mb-5">
                <label for="surface-ajoutee" class="block text-sm font-semibold text-slate-700 mb-1">
                  Surface ajoutÃ©e par les travaux (mÂ²)
                  <span class="text-xs font-normal text-slate-400 ml-1">â€” 0 si aucune extension</span>
                </label>
                <p id="surface-hint" class="hidden text-xs text-blue-600 bg-blue-50 border border-blue-100 rounded-lg px-3 py-2 mb-2 leading-relaxed">
                  Pour une extension, indiquez la surface habitable crÃ©Ã©e.
                </p>
                <div class="relative">
                  <input
                    id="surface-ajoutee"
                    type="number"
                    min="0"
                    step="1"
                    placeholder="0"
                    value="0"
                    class="w-full rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 pr-12 text-slate-900 text-base font-medium placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-primary/30 focus:border-primary transition-colors"
                  />
                  <span class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 font-semibold text-xs pointer-events-none">mÂ²</span>
                </div>
              </div>

              <!-- Loyer actuel (optionnel) -->
              <div class="mb-5">
                <label for="current-rent" class="block text-sm font-semibold text-slate-700 mb-1">
                  Loyer mensuel actuel (â‚¬)
                  <span class="text-xs font-normal text-slate-400 ml-1">â€” optionnel</span>
                </label>
                <p class="text-xs text-slate-400 mb-2 leading-relaxed">
                  Si renseignÃ©, nous comparons votre loyer actuel au potentiel estimÃ© aprÃ¨s travaux.
                </p>
                <div class="relative">
                  <input
                    id="current-rent"
                    type="number"
                    min="0"
                    step="50"
                    placeholder="Ex. 800"
                    class="w-full rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 pr-16 text-slate-900 text-base font-medium placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-primary/30 focus:border-primary transition-colors"
                  />
                  <span class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 font-semibold text-xs pointer-events-none">â‚¬/mois</span>
                </div>
              </div>

            </div><!-- /location-extra -->

            <!-- Message d'erreur -->
            <p id="form-error" class="hidden mb-4 text-sm text-red-600 bg-red-50 border border-red-200 rounded-lg px-4 py-2.5">
              <span id="form-error-text">Merci de renseigner tous les champs obligatoires.</span>
            </p>

            <!-- Submit -->
            <button
              id="btn-estimate"
              type="button"
              class="w-full flex items-center justify-center gap-2 bg-primary text-primary-foreground hover:bg-primary/90 font-semibold rounded-xl px-6 py-3.5 text-sm transition-colors shadow-sm"
            >
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z" />
              </svg>
              Estimer l'impact
            </button>
          </div>

          <!-- â”€â”€ RÃ‰SULTAT (masquÃ© par dÃ©faut) â”€â”€ -->
          <div
            id="result"
            class="hidden bg-white rounded-2xl border border-slate-200 shadow-md overflow-hidden"
            aria-live="polite"
            aria-atomic="true"
          >
            <!-- Barre de couleur en haut -->
            <div id="result-top-bar" class="h-1.5 w-full bg-emerald-500 transition-colors duration-500"></div>

            <div class="p-6 sm:p-8 space-y-5">

              <!-- Verdict global -->
              <div class="flex items-center gap-3">
                <span id="result-emoji" class="text-3xl leading-none" aria-hidden="true">ğŸŸ¢</span>
                <div>
                  <p class="text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-0.5">Estimation</p>
                  <p id="result-verdict" class="text-xl font-black text-slate-900 leading-tight"></p>
                </div>
              </div>

              <!-- â”€â”€ Bloc REVENTE â”€â”€ -->
              <div id="result-revente" class="hidden rounded-xl bg-slate-50 border border-slate-200 overflow-hidden">
                <p class="text-[10px] font-bold uppercase tracking-widest text-slate-400 px-5 pt-4 pb-3 border-b border-slate-200">
                  Impact sur la valeur de revente
                </p>
                <div class="px-5 py-4 space-y-3">

                  <!-- Fourchette % du budget -->
                  <div class="flex items-center justify-between gap-2 flex-wrap">
                    <p class="text-sm text-slate-600">RÃ©cupÃ©ration du budget en valeur</p>
                    <p id="result-pct" class="text-base font-black tabular-nums text-slate-900"></p>
                  </div>

                  <!-- Gain en â‚¬ -->
                  <div class="flex items-center justify-between gap-2 flex-wrap">
                    <p class="text-sm text-slate-600">Gain de valeur estimÃ©</p>
                    <p id="result-gain-eur" class="text-base font-black tabular-nums text-emerald-700"></p>
                  </div>

                  <!-- % de la valeur du bien (si fournie) -->
                  <div id="result-pct-bien-row" class="hidden">
                    <div class="flex items-center justify-between gap-2 flex-wrap">
                      <p class="text-sm text-slate-600">Soit environ</p>
                      <p id="result-pct-bien" class="text-base font-black tabular-nums text-primary"></p>
                    </div>
                  </div>

                  <!-- Barre de progression -->
                  <div class="w-full h-2 bg-slate-200 rounded-full overflow-hidden pt-1">
                    <div
                      id="result-bar"
                      class="h-full rounded-full transition-all duration-700 ease-out bg-emerald-500"
                      style="width: 0%"
                    ></div>
                  </div>
                  <div class="flex justify-between text-[10px] text-slate-400 -mt-1">
                    <span>0 %</span><span>50 %</span><span>100 %</span>
                  </div>

                  <!-- Hint si valeur du bien non renseignÃ©e -->
                  <div id="result-no-value-hint" class="hidden pt-2 border-t border-slate-200">
                    <p class="text-xs text-slate-500 italic leading-relaxed">
                      ğŸ’¡ Ajoutez la valeur estimÃ©e de votre bien (champ optionnel ci-dessus) pour voir ce gain exprimÃ© en % de sa valeur totale.
                    </p>
                  </div>

                </div>
              </div>

              <!-- â”€â”€ Bloc LOCATION â”€â”€ -->
              <div id="result-rental" class="hidden rounded-xl bg-blue-50 border border-blue-200 overflow-hidden">
                <p class="text-[10px] font-bold uppercase tracking-widest text-blue-500 px-5 pt-4 pb-3 border-b border-blue-200">
                  Impact locatif estimÃ©
                </p>
                <div class="px-5 py-4 space-y-3">

                  <!-- Loyer estimÃ© aprÃ¨s travaux -->
                  <div class="flex items-center justify-between gap-2 flex-wrap">
                    <p class="text-sm text-blue-700">Loyer estimÃ© aprÃ¨s travaux</p>
                    <p id="result-loyer-apres" class="text-base font-black tabular-nums text-blue-900"></p>
                  </div>

                  <!-- Hausse de loyer -->
                  <div class="flex items-center justify-between gap-2 flex-wrap">
                    <p class="text-sm text-blue-700">Hausse de loyer estimÃ©e</p>
                    <p id="result-hausse" class="text-base font-black tabular-nums text-blue-900"></p>
                  </div>

                  <!-- SÃ©parateur -->
                  <div class="border-t border-blue-200 pt-3 space-y-3">

                    <!-- Gain annuel -->
                    <div class="flex items-center justify-between gap-2 flex-wrap">
                      <p class="text-sm text-blue-700">Gain annuel estimÃ©</p>
                      <p id="result-gain-annuel" class="text-sm font-bold tabular-nums text-blue-800"></p>
                    </div>

                    <!-- Retour sur investissement -->
                    <div id="result-payback-row" class="hidden">
                      <div class="flex items-center justify-between gap-2 flex-wrap">
                        <p class="text-sm text-blue-700">Retour sur investissement</p>
                        <p id="result-payback" class="text-sm font-bold tabular-nums text-blue-800"></p>
                      </div>
                    </div>

                  </div>

                  <!-- Contexte -->
                  <p id="result-rental-context" class="text-[11px] text-blue-500 leading-relaxed italic pt-2 border-t border-blue-200"></p>

                </div>
              </div>

              <!-- â”€â”€ Message pÃ©dagogique â”€â”€ -->
              <div id="result-message-box" class="rounded-xl border p-4 transition-colors duration-300">
                <p id="result-message-title-row" class="text-xs font-bold mb-1.5 flex items-center gap-1.5">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 001.5-.189m-1.5.189a6.01 6.01 0 01-1.5-.189m3.75 7.478a12.06 12.06 0 01-4.5 0m3.75 2.383a14.406 14.406 0 01-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 10-7.517 0c.85.493 1.509 1.333 1.509 2.316V18" />
                  </svg>
                  <span id="result-message-title">Pourquoi ce rÃ©sultat ?</span>
                </p>
                <p id="result-message" class="text-sm leading-relaxed"></p>
              </div>

              <!-- Avertissement -->
              <p class="text-xs text-slate-400 italic text-center leading-relaxed">
                Estimation indicative basÃ©e sur des barÃ¨mes de marchÃ© moyens â€”
                les rÃ©sultats varient selon la localisation, la qualitÃ© d'exÃ©cution et l'Ã©tat initial du bien.
              </p>

              <!-- CTA -->
              <a
                href="/nouvelle-analyse"
                class="w-full flex items-center justify-center gap-2 bg-slate-900 text-white hover:bg-slate-800 font-semibold rounded-xl px-6 py-3.5 text-sm transition-colors"
              >
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5" />
                </svg>
                Analyser mon devis pour une estimation dÃ©taillÃ©e
              </a>
              <p class="text-center text-xs text-slate-400 !mt-2">
                Gratuit Â· Confidentiel Â· RÃ©sultat en 2 minutes avec votre devis rÃ©el
              </p>

            </div>
          </div>

        </div>
      </section>

      <!-- â•â• EXPLICATION + MAILLAGE â•â• -->
      <section class="py-10 sm:py-12 border-t border-slate-200">
        <div class="container max-w-xl">
          <div class="mb-6">
            <p class="text-xs font-bold uppercase tracking-widest text-slate-400 mb-3">Comment fonctionne ce simulateur ?</p>
            <p class="text-sm text-slate-600 leading-relaxed mb-3">
              En mode <strong>Revente</strong>, le simulateur applique des fourchettes de rÃ©cupÃ©ration
              du budget en valeur immobiliÃ¨re, issues d'observations du marchÃ© franÃ§ais par type de travaux.
              En mode <strong>Location</strong>, il calcule un loyer de rÃ©fÃ©rence au mÂ² selon la zone et
              le type de bien, puis estime la hausse de loyer, le gain annuel et le retour sur investissement.
            </p>
            <p class="text-sm text-slate-600 leading-relaxed">
              Ces estimations sont des ordres de grandeur. Pour une analyse prÃ©cise basÃ©e sur votre devis rÃ©el,
              dÃ©posez-le sur VerifierMonDevis.fr : comparaison des prix du marchÃ© et Indice StratÃ©gique Immobilierâ„¢ inclus.
            </p>
          </div>
          <div class="flex flex-wrap gap-3 text-sm">
            <a href="/nouvelle-analyse" class="inline-flex items-center gap-1.5 bg-primary text-primary-foreground hover:bg-primary/90 px-4 py-2 rounded-lg font-medium transition-colors">
              Analyser mon devis
            </a>
            <a href="/valorisation-travaux-immobiliers" class="inline-flex items-center gap-1.5 border border-slate-300 text-slate-700 hover:bg-slate-50 px-4 py-2 rounded-lg transition-colors">
              Guide valorisation des travaux
            </a>
            <a href="/faq" class="inline-flex items-center gap-1.5 border border-slate-300 text-slate-700 hover:bg-slate-50 px-4 py-2 rounded-lg transition-colors">
              FAQ
            </a>
          </div>
        </div>
      </section>

    </main>

    <AstroFooter />
  </div>
</BaseLayout>

<!-- â•â• LOGIQUE SIMULATEUR V2 â•â• -->
<script>
  // â”€â”€ Types â”€â”€
  type WorkType     = 'extension' | 'renovation_complete' | 'cuisine_sdb' | 'isolation_energie' | 'rafraichissement';
  type Objective    = 'revente' | 'location';
  type ZoneType     = 'tendue' | 'intermediaire' | 'detendue';
  type PropertyType = 'appartement' | 'maison';
  type VerdictLevel = 'fort' | 'modere' | 'limite';

  // â”€â”€ Config patrimoniale (% du budget rÃ©cupÃ©rÃ© en valeur) â”€â”€
  interface WorkConfig {
    min: number;         // fraction, ex. 0.80
    max: number;
    msgBoxTitle: string;
  }

  const CONFIG: Record<WorkType, Record<Objective, WorkConfig>> = {
    extension: {
      revente:  { min: 0.80, max: 0.95, msgBoxTitle: "Pourquoi un fort impact ?" },
      location: { min: 0.65, max: 0.80, msgBoxTitle: "Pourquoi un fort impact ?" },
    },
    renovation_complete: {
      revente:  { min: 0.65, max: 0.85, msgBoxTitle: "Pourquoi un fort impact ?" },
      location: { min: 0.55, max: 0.72, msgBoxTitle: "Ce qui fait varier l'impact" },
    },
    cuisine_sdb: {
      revente:  { min: 0.50, max: 0.75, msgBoxTitle: "Ce qui fait varier l'impact" },
      location: { min: 0.40, max: 0.60, msgBoxTitle: "Ce qui fait varier l'impact" },
    },
    isolation_energie: {
      revente:  { min: 0.55, max: 0.80, msgBoxTitle: "L'effet DPE" },
      location: { min: 0.55, max: 0.75, msgBoxTitle: "L'effet DPE" },
    },
    rafraichissement: {
      revente:  { min: 0.15, max: 0.35, msgBoxTitle: "Pourquoi l'impact est faible ?" },
      location: { min: 0.10, max: 0.25, msgBoxTitle: "Pourquoi l'impact est faible ?" },
    },
  };

  // â”€â”€ Niveaux de verdict dÃ©rivÃ©s du CONFIG â”€â”€
  interface VerdictStyle {
    label: string; emoji: string;
    barColor: string; topBarColor: string;
    msgBoxBg: string; msgBoxBorder: string; msgBoxTextColor: string;
  }

  const VERDICT_STYLES: Record<VerdictLevel, VerdictStyle> = {
    fort:   { label: 'Fort',   emoji: 'ğŸŸ¢', barColor: 'bg-emerald-500', topBarColor: 'bg-emerald-500', msgBoxBg: 'bg-emerald-50', msgBoxBorder: 'border-emerald-200', msgBoxTextColor: 'text-emerald-800' },
    modere: { label: 'ModÃ©rÃ©', emoji: 'ğŸŸ¡', barColor: 'bg-amber-400',   topBarColor: 'bg-amber-400',   msgBoxBg: 'bg-amber-50',   msgBoxBorder: 'border-amber-200',   msgBoxTextColor: 'text-amber-800'   },
    limite: { label: 'LimitÃ©', emoji: 'ğŸ”´', barColor: 'bg-red-400',     topBarColor: 'bg-red-400',     msgBoxBg: 'bg-red-50',     msgBoxBorder: 'border-red-200',     msgBoxTextColor: 'text-red-800'     },
  };

  function getVerdictLevel(min: number, max: number): VerdictLevel {
    const avg = (min + max) / 2;
    if (avg >= 0.60) return 'fort';
    if (avg >= 0.35) return 'modere';
    return 'limite';
  }

  // â”€â”€ BarÃ¨me loyer au mÂ² (Location) â”€â”€
  // Source : observatoire des loyers INSEE / OLAP, moyennes 2023-2024
  const LOYER_M2: Record<ZoneType, Record<PropertyType, { min: number; max: number }>> = {
    tendue:        { appartement: { min: 22, max: 30 }, maison: { min: 16, max: 24 } },
    intermediaire: { appartement: { min: 14, max: 20 }, maison: { min: 11, max: 16 } },
    detendue:      { appartement: { min: 9,  max: 13 }, maison: { min: 7,  max: 11 } },
  };

  const ZONE_LABELS: Record<ZoneType, string> = {
    tendue:        'zone tendue',
    intermediaire: 'zone intermÃ©diaire',
    detendue:      'zone dÃ©tendue',
  };

  // â”€â”€ Messages pÃ©dagogiques â”€â”€
  const MESSAGES: Record<WorkType, Record<Objective, string>> = {
    extension: {
      revente:  "Une extension crÃ©e de la surface habitable â€” l'un des meilleurs leviers de valorisation. Les acheteurs paient au mÂ², et chaque mÂ² supplÃ©mentaire est valorisÃ© au prix du marchÃ© local. L'impact est d'autant plus fort que le marchÃ© est tendu.",
      location: "Une extension augmente directement la surface louable. Le loyer supplÃ©mentaire est calculÃ© sur les mÂ² crÃ©Ã©s au barÃ¨me de votre zone. Dans les marchÃ©s oÃ¹ la surface est rare, l'impact locatif peut dÃ©passer la fourchette estimÃ©e.",
    },
    renovation_complete: {
      revente:  "Une rÃ©novation complÃ¨te rassure les acheteurs et rÃ©duit leur perception de risque. Elle permet de se positionner dans la fourchette haute du marchÃ© local â€” Ã  condition que l'investissement reste cohÃ©rent avec le plafond de prix du quartier.",
      location: "Un bien entiÃ¨rement rÃ©novÃ© peut prÃ©tendre au haut de la fourchette de loyer de sa zone. L'estimation montre l'Ã©cart entre bas et haut du barÃ¨me local. Renseignez votre loyer actuel pour affiner le calcul.",
    },
    cuisine_sdb: {
      revente:  "La cuisine et la salle de bain sont les deux piÃ¨ces les plus scrutÃ©es lors d'une visite. L'impact est fort si elles Ã©taient vÃ©tustes, plus modÃ©rÃ© si elles Ã©taient fonctionnelles. Une cuisine sobre et neutre attire davantage d'acheteurs.",
      location: "Une cuisine et une SDB rÃ©novÃ©es rÃ©duisent la vacance et permettent de viser le haut de la fourchette locative locale. L'impact est modÃ©rÃ© â€” la surface reste inchangÃ©e, c'est la qualitÃ© perÃ§ue qui Ã©volue.",
    },
    isolation_energie: {
      revente:  "Le DPE est devenu un critÃ¨re d'achat dÃ©terminant. Un logement classÃ© F ou G subit une dÃ©cote de 5 Ã  15 % selon les marchÃ©s. Passer Ã  la classe C ou D peut gÃ©nÃ©rer une revalorisation significative, parfois supÃ©rieure au coÃ»t des travaux.",
      location: "Une bonne Ã©tiquette Ã©nergÃ©tique est exigÃ©e par les locataires et imposÃ©e par la loi pour les passoires thermiques. L'impact sur le loyer est modÃ©rÃ© â€” c'est surtout la mise en location qui devient possible et le risque de vacance qui diminue.",
    },
    rafraichissement: {
      revente:  "Le rafraÃ®chissement amÃ©liore la premiÃ¨re impression lors des visites, mais les acheteurs repeignent selon leurs propres goÃ»ts. L'impact sur le prix de vente reste faible (1 Ã  3 %). Ces travaux sont utiles pour votre confort, pas pour la revente.",
      location: "L'impact sur le loyer est trÃ¨s limitÃ©. Les locataires cherchent avant tout la fonctionnalitÃ©, le DPE et la localisation. Le rafraÃ®chissement peut rÃ©duire la vacance marginalement mais ne justifie pas un loyer significativement plus Ã©levÃ©.",
    },
  };

  // â”€â”€ Ã‰tat â”€â”€
  let selectedObjective: Objective = 'revente';

  // â”€â”€ Utilitaires â”€â”€
  function formatEuro(n: number): string {
    return new Intl.NumberFormat('fr-FR', { style: 'currency', currency: 'EUR', maximumFractionDigits: 0 }).format(n);
  }

  function formatPct(n: number, decimals = 1): string {
    return n.toFixed(decimals).replace('.', ',') + ' %';
  }

  function formatPayback(years: number): string {
    if (years >= 30) return '> 30 ans';
    if (years >= 10) return `${Math.round(years)} ans`;
    return `${years.toFixed(1).replace('.', ',')} ans`;
  }

  function el<T extends HTMLElement = HTMLElement>(id: string): T {
    return document.getElementById(id) as T;
  }

  function show(id: string) { el(id).classList.remove('hidden'); }
  function hide(id: string) { el(id).classList.add('hidden'); }

  // â”€â”€ VisibilitÃ© des champs selon l'objectif â”€â”€
  function updateFieldVisibility() {
    if (selectedObjective === 'revente') {
      show('revente-extra');
      hide('location-extra');
    } else {
      hide('revente-extra');
      show('location-extra');
    }
    // Hint surface si extension sÃ©lectionnÃ©
    const workType = el<HTMLSelectElement>('work-type').value;
    if (workType === 'extension') {
      show('surface-hint');
    } else {
      hide('surface-hint');
    }
  }

  // â”€â”€ Toggle objectif â”€â”€
  function setObjective(obj: Objective) {
    selectedObjective = obj;
    const btnRevente  = el<HTMLButtonElement>('btn-revente');
    const btnLocation = el<HTMLButtonElement>('btn-location');

    const activeClasses   = ['border-primary', 'bg-primary/5', 'text-primary'];
    const inactiveClasses = ['border-slate-200', 'bg-slate-50', 'text-slate-500'];

    if (obj === 'revente') {
      activeClasses.forEach(c   => btnRevente.classList.add(c));
      inactiveClasses.forEach(c => btnRevente.classList.remove(c));
      inactiveClasses.forEach(c => btnLocation.classList.add(c));
      activeClasses.forEach(c   => btnLocation.classList.remove(c));
    } else {
      activeClasses.forEach(c   => btnLocation.classList.add(c));
      inactiveClasses.forEach(c => btnLocation.classList.remove(c));
      inactiveClasses.forEach(c => btnRevente.classList.add(c));
      activeClasses.forEach(c   => btnRevente.classList.remove(c));
    }

    updateFieldVisibility();
    // Masquer les rÃ©sultats si l'objectif change aprÃ¨s une estimation
    hide('result');
  }

  // â”€â”€ Calcul principal â”€â”€
  function estimate() {
    const budgetEl   = el<HTMLInputElement>('budget');
    const workTypeEl = el<HTMLSelectElement>('work-type');
    const errorEl    = el('form-error');
    const errorText  = el('form-error-text');

    const budget   = parseFloat(budgetEl.value);
    const workType = workTypeEl.value as WorkType | '';

    // Validation de base
    if (!budget || budget < 1000 || !workType) {
      errorText.textContent = 'Merci de renseigner un budget (min. 1 000 â‚¬) et un type de travaux.';
      show('form-error');
      budgetEl.focus();
      return;
    }
    hide('form-error');

    const cfg   = CONFIG[workType as WorkType][selectedObjective];
    const level = getVerdictLevel(cfg.min, cfg.max);
    const style = VERDICT_STYLES[level];

    // â”€â”€ Verdict + couleurs â”€â”€
    const objectiveLabel = selectedObjective === 'revente' ? 'revente' : 'locatif';
    el('result-verdict').textContent  = `Impact ${objectiveLabel} : ${style.label}`;
    el('result-emoji').textContent    = style.emoji;
    el('result-top-bar').className    = `h-1.5 w-full transition-colors duration-500 ${style.topBarColor}`;

    // â”€â”€ Message pÃ©dagogique â”€â”€
    const msgBox       = el('result-message-box');
    const msgTitleRow  = el('result-message-title-row');
    const msgTitleSpan = el('result-message-title');
    const msgText      = el('result-message');
    msgBox.className      = `rounded-xl border p-4 transition-colors duration-300 ${style.msgBoxBg} ${style.msgBoxBorder}`;
    msgTitleRow.className = `text-xs font-bold mb-1.5 flex items-center gap-1.5 ${style.msgBoxTextColor}`;
    msgTitleSpan.textContent = cfg.msgBoxTitle;
    msgText.className     = `text-sm leading-relaxed ${style.msgBoxTextColor}`;
    msgText.textContent   = MESSAGES[workType as WorkType][selectedObjective];

    // RÃ©initialiser les deux blocs
    hide('result-revente');
    hide('result-rental');
    hide('result-payback-row');

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // MODE REVENTE
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    if (selectedObjective === 'revente') {
      const gainMin = Math.round(budget * cfg.min);
      const gainMax = Math.round(budget * cfg.max);
      const avgPct  = Math.round(((cfg.min + cfg.max) / 2) * 100);

      el('result-pct').textContent     = `${Math.round(cfg.min * 100)} â€“ ${Math.round(cfg.max * 100)} % du budget`;
      el('result-gain-eur').textContent = `${formatEuro(gainMin)} Ã  ${formatEuro(gainMax)}`;

      // Barre de progression
      const bar = el('result-bar');
      bar.className = `h-full rounded-full transition-all duration-700 ease-out ${style.barColor}`;
      setTimeout(() => { bar.style.width = `${Math.min(avgPct, 100)}%`; }, 50);

      // % de la valeur du bien
      const propertyValue = parseFloat(el<HTMLInputElement>('property-value').value) || 0;
      if (propertyValue > 100000) {
        const pctBienMin = gainMin / propertyValue * 100;
        const pctBienMax = gainMax / propertyValue * 100;
        el('result-pct-bien').textContent = `${formatPct(pctBienMin, 1)} Ã  ${formatPct(pctBienMax, 1)} de la valeur du bien`;
        show('result-pct-bien-row');
        hide('result-no-value-hint');
      } else {
        hide('result-pct-bien-row');
        show('result-no-value-hint');
      }

      show('result-revente');

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // MODE LOCATION
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    } else {
      const zoneEl         = el<HTMLSelectElement>('location-zone');
      const propertyTypeEl = el<HTMLSelectElement>('property-type');
      const surfaceActEl   = el<HTMLInputElement>('surface-actuelle');
      const surfaceAjEl    = el<HTMLInputElement>('surface-ajoutee');
      const currentRentEl  = el<HTMLInputElement>('current-rent');

      const zone         = zoneEl.value         as ZoneType | '';
      const propertyType = propertyTypeEl.value  as PropertyType | '';
      const surfaceActuelle = parseFloat(surfaceActEl.value) || 0;
      const surfaceAjoutee  = parseFloat(surfaceAjEl.value)  || 0;
      const currentRent     = parseFloat(currentRentEl.value) || 0;

      // Validation Location
      if (!zone || !propertyType) {
        errorText.textContent = 'Merci de sÃ©lectionner la zone de marchÃ© et le type de bien.';
        show('form-error');
        zoneEl.focus();
        return;
      }
      if (!surfaceActuelle || surfaceActuelle < 5) {
        errorText.textContent = 'Merci de renseigner la surface actuelle du bien (minimum 5 mÂ²).';
        show('form-error');
        surfaceActEl.focus();
        return;
      }
      hide('form-error');

      const lm2          = LOYER_M2[zone as ZoneType][propertyType as PropertyType];
      const surfaceApres = surfaceActuelle + surfaceAjoutee;

      // Loyer marchÃ© aprÃ¨s travaux (fourchette)
      const loyerApresMin = Math.round(surfaceApres * lm2.min);
      const loyerApresMax = Math.round(surfaceApres * lm2.max);

      // Delta loyer selon les donnÃ©es disponibles
      let deltaMin: number;
      let deltaMax: number;
      let contextLine: string;

      const propLabel  = propertyType === 'appartement' ? 'appartement' : 'maison';
      const zoneName   = ZONE_LABELS[zone as ZoneType];
      const bareLabel  = `BarÃ¨me ${zoneName} : ${lm2.min}â€“${lm2.max} â‚¬/mÂ²`;

      if (currentRent > 0) {
        // Comparaison loyer actuel â†’ loyer marchÃ© aprÃ¨s travaux
        deltaMin = Math.max(0, loyerApresMin - currentRent);
        deltaMax = Math.max(0, loyerApresMax - currentRent);
        contextLine = `ComparÃ© Ã  votre loyer actuel de ${formatEuro(currentRent)}/mois. ${bareLabel}.`;

      } else if (surfaceAjoutee > 0) {
        // Extension : delta = surface ajoutÃ©e Ã— barÃ¨me
        deltaMin = Math.round(surfaceAjoutee * lm2.min);
        deltaMax = Math.round(surfaceAjoutee * lm2.max);
        contextLine = `+${surfaceAjoutee} mÂ² Ã— ${lm2.min}â€“${lm2.max} â‚¬/mÂ² = loyer additionnel. Surface totale aprÃ¨s : ${surfaceApres} mÂ².`;

      } else {
        // Pas d'extension, pas de loyer actuel : Ã©cart basâ†’haut de gamme du barÃ¨me
        // (rÃ©novation qui fait passer du bas au haut de la fourchette de marchÃ©)
        deltaMin = 0;
        deltaMax = Math.round(surfaceActuelle * (lm2.max - lm2.min));
        contextLine = `Passage du bas au haut du barÃ¨me ${zoneName} pour un ${propLabel} de ${surfaceActuelle} mÂ². Renseignez votre loyer actuel pour un calcul prÃ©cis.`;
      }

      // Affichage loyer aprÃ¨s
      el('result-loyer-apres').textContent = `${loyerApresMin} â€“ ${loyerApresMax} â‚¬/mois`;

      // Hausse de loyer
      if (deltaMax > 0) {
        el('result-hausse').textContent = deltaMin === 0
          ? `jusqu'Ã  +${formatEuro(deltaMax)}/mois`
          : `+${formatEuro(deltaMin)} Ã  +${formatEuro(deltaMax)}/mois`;

        // Gain annuel
        const gainAMin = deltaMin * 12;
        const gainAMax = deltaMax * 12;
        el('result-gain-annuel').textContent = deltaMin === 0
          ? `jusqu'Ã  +${formatEuro(gainAMax)}/an`
          : `+${formatEuro(gainAMin)} Ã  +${formatEuro(gainAMax)}/an`;

        // Retour sur investissement (budget / gain annuel)
        // paybackFastest = budget / gainAMax (optimiste)
        // paybackSlowest = budget / gainAMin (pessimiste, âˆ si deltaMin = 0)
        const paybackFastest = budget / gainAMax; // toujours dÃ©fini car deltaMax > 0
        if (deltaMin > 0) {
          const paybackSlowest = budget / gainAMin;
          el('result-payback').textContent = paybackSlowest <= 30
            ? `${formatPayback(paybackFastest)} Ã  ${formatPayback(paybackSlowest)}`
            : `Ã  partir de ${formatPayback(paybackFastest)}`;
        } else {
          // deltaMin = 0 â†’ seulement la borne optimiste est calculable
          el('result-payback').textContent = `${formatPayback(paybackFastest)} (dans le meilleur cas)`;
        }
        show('result-payback-row');

      } else {
        // deltaMax = 0 : cas rare (rafraÃ®chissement zone dÃ©tendue sans loyer actuel)
        el('result-hausse').textContent     = 'Impact marginal sur ce marchÃ©';
        el('result-gain-annuel').textContent = 'Renseignez votre loyer actuel pour estimer';
        hide('result-payback-row');
      }

      el('result-rental-context').textContent = contextLine;
      show('result-rental');
    }

    // â”€â”€ Affichage du bloc rÃ©sultat â”€â”€
    const resultEl = el('result');
    resultEl.classList.remove('hidden');
    setTimeout(() => {
      resultEl.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }, 100);
  }

  // â”€â”€ Event listeners â”€â”€
  el('btn-revente')?.addEventListener('click',  () => setObjective('revente'));
  el('btn-location')?.addEventListener('click', () => setObjective('location'));
  el('btn-estimate')?.addEventListener('click', estimate);
  el<HTMLInputElement>('work-type')?.addEventListener('change', updateFieldVisibility);
  el<HTMLInputElement>('budget')?.addEventListener('keydown', (e) => {
    if ((e as KeyboardEvent).key === 'Enter') estimate();
  });

  // Init
  updateFieldVisibility();
</script>
