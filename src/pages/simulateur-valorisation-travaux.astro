---
import BaseLayout from '@/layouts/BaseLayout.astro';
import AstroHeader from '@/components/astro/Header.astro';
import AstroFooter from '@/components/astro/Footer.astro';

const jsonLd = {
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": "Simulateur de valorisation des travaux immobiliers",
  "description": "Estimez en quelques secondes l'impact potentiel de vos travaux sur la valeur de votre bien immobilier.",
  "url": "https://verifiermondevis.fr/simulateur-valorisation-travaux",
  "applicationCategory": "UtilitiesApplication",
  "operatingSystem": "Web",
  "offers": { "@type": "Offer", "price": "0", "priceCurrency": "EUR" }
};
---

<BaseLayout
  title="Simulateur de valorisation des travaux immobiliers | VerifierMonDevis.fr"
  description="Estimez en quelques secondes l'impact potentiel de vos travaux sur la valeur de votre bien. Simulateur gratuit, rapide et p√©dagogique."
  canonical="https://verifiermondevis.fr/simulateur-valorisation-travaux"
  ogType="article"
  jsonLd={jsonLd}
  breadcrumbs={[
    { name: "Accueil",                  url: "https://verifiermondevis.fr/" },
    { name: "Valorisation des travaux", url: "https://verifiermondevis.fr/valorisation-travaux-immobiliers" },
    { name: "Simulateur",               url: "https://verifiermondevis.fr/simulateur-valorisation-travaux" }
  ]}
>
  <div class="min-h-screen flex flex-col">
    <AstroHeader />

    <main class="flex-1">

      <!-- ‚ïê‚ïê HERO ‚ïê‚ïê -->
      <section class="bg-gradient-to-b from-slate-900 to-slate-800 text-white py-14 sm:py-18">
        <div class="container max-w-2xl text-center">
          <a
            href="/valorisation-travaux-immobiliers"
            class="inline-flex items-center gap-1.5 text-slate-400 hover:text-white mb-6 transition-colors text-xs"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
            </svg>
            Guide valorisation des travaux
          </a>

          <div class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-white/10 text-xs font-medium text-slate-300 mb-5">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z" />
            </svg>
            Simulateur gratuit
          </div>

          <h1 class="text-3xl sm:text-4xl font-bold leading-tight mb-4">
            Simulateur de valorisation<br class="hidden sm:block" />
            des travaux immobiliers
          </h1>
          <p class="text-slate-300 text-base sm:text-lg leading-relaxed max-w-xl mx-auto">
            Estimez en quelques secondes la part de votre investissement qui se retrouvera
            dans la valeur de revente ou la rentabilit√© locative de votre bien.
          </p>
        </div>
      </section>

      <!-- ‚ïê‚ïê SIMULATEUR ‚ïê‚ïê -->
      <section class="py-10 sm:py-14 bg-slate-50">
        <div class="container max-w-xl">

          <!-- ‚îÄ‚îÄ FORMULAIRE ‚îÄ‚îÄ -->
          <div class="bg-white rounded-2xl border border-slate-200 shadow-md p-6 sm:p-8 mb-6">

            <p class="text-xs font-bold uppercase tracking-widest text-slate-400 mb-5">
              Renseignez votre projet
            </p>

            <!-- 1. Budget -->
            <div class="mb-5">
              <label for="budget" class="block text-sm font-semibold text-slate-700 mb-2">
                Budget travaux <span class="text-red-500">*</span>
              </label>
              <div class="relative">
                <input
                  id="budget"
                  type="number"
                  min="1000"
                  step="1000"
                  placeholder="Ex. 25 000"
                  class="w-full rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 pr-10 text-slate-900 text-base font-medium placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-primary/30 focus:border-primary transition-colors"
                />
                <span class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 font-semibold text-sm pointer-events-none">‚Ç¨</span>
              </div>
            </div>

            <!-- 2. Type de travaux -->
            <div class="mb-5">
              <label for="work-type" class="block text-sm font-semibold text-slate-700 mb-2">
                Type principal de travaux <span class="text-red-500">*</span>
              </label>
              <div class="relative">
                <select
                  id="work-type"
                  class="w-full appearance-none rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 pr-10 text-slate-900 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-primary/30 focus:border-primary transition-colors cursor-pointer"
                >
                  <option value="">S√©lectionner le type de travaux‚Ä¶</option>
                  <option value="extension">üèóÔ∏è Extension / sur√©l√©vation</option>
                  <option value="renovation_complete">üè† R√©novation compl√®te</option>
                  <option value="cuisine_sdb">üõÅ Cuisine / Salle de bain</option>
                  <option value="isolation_energie">üåø Isolation / R√©novation √©nerg√©tique</option>
                  <option value="rafraichissement">üé® Rafra√Æchissement / Peinture</option>
                </select>
                <svg xmlns="http://www.w3.org/2000/svg" class="absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400 pointer-events-none" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                </svg>
              </div>
            </div>

            <!-- 3. Objectif -->
            <div class="mb-5">
              <p class="block text-sm font-semibold text-slate-700 mb-2">
                Votre objectif <span class="text-red-500">*</span>
              </p>
              <div class="grid grid-cols-2 gap-3">
                <button
                  id="btn-revente"
                  type="button"
                  class="flex flex-col items-center gap-1.5 rounded-xl border-2 border-primary bg-primary/5 px-4 py-3.5 text-sm font-semibold text-primary transition-all"
                >
                  <span class="text-xl">üè†</span>
                  <span>Revente</span>
                </button>
                <button
                  id="btn-location"
                  type="button"
                  class="flex flex-col items-center gap-1.5 rounded-xl border-2 border-slate-200 bg-slate-50 px-4 py-3.5 text-sm font-semibold text-slate-500 transition-all hover:border-slate-300"
                >
                  <span class="text-xl">üîë</span>
                  <span>Location</span>
                </button>
              </div>
            </div>

            <!-- 4. Zone de march√© -->
            <div class="mb-5">
              <label for="location-zone" class="block text-sm font-semibold text-slate-700 mb-2">
                Zone de march√© <span class="text-red-500">*</span>
              </label>
              <div class="relative">
                <select
                  id="location-zone"
                  class="w-full appearance-none rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 pr-10 text-slate-900 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-primary/30 focus:border-primary transition-colors cursor-pointer"
                >
                  <option value="">S√©lectionner la zone‚Ä¶</option>
                  <option value="tendue">üèôÔ∏è Zone tendue (grande ville / forte demande)</option>
                  <option value="intermediaire">üèòÔ∏è Zone interm√©diaire</option>
                  <option value="detendue">üåæ Zone d√©tendue (march√© rural / faible demande)</option>
                </select>
                <svg xmlns="http://www.w3.org/2000/svg" class="absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400 pointer-events-none" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                </svg>
              </div>
            </div>

            <!-- 5. Type de bien -->
            <div class="mb-5">
              <label for="property-type" class="block text-sm font-semibold text-slate-700 mb-2">
                Type de bien <span class="text-red-500">*</span>
              </label>
              <div class="relative">
                <select
                  id="property-type"
                  class="w-full appearance-none rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 pr-10 text-slate-900 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-primary/30 focus:border-primary transition-colors cursor-pointer"
                >
                  <option value="">S√©lectionner le type de bien‚Ä¶</option>
                  <option value="appartement">üè¢ Appartement</option>
                  <option value="maison">üè° Maison</option>
                </select>
                <svg xmlns="http://www.w3.org/2000/svg" class="absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400 pointer-events-none" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                </svg>
              </div>
            </div>

            <!-- 6. Loyer actuel (affich√© uniquement en mode Location) -->
            <div id="rent-field" class="mb-5 hidden">
              <label for="current-rent" class="block text-sm font-semibold text-slate-700 mb-1">
                Loyer mensuel actuel (‚Ç¨)
                <span class="text-xs font-normal text-slate-400 ml-1">‚Äì optionnel</span>
              </label>
              <p class="text-xs text-slate-400 mb-2 leading-relaxed">
                Si renseign√©, nous estimons le gain de rendement brut annuel.
              </p>
              <div class="relative">
                <input
                  id="current-rent"
                  type="number"
                  min="0"
                  step="50"
                  placeholder="Ex. 800"
                  class="w-full rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 pr-12 text-slate-900 text-base font-medium placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-primary/30 focus:border-primary transition-colors"
                />
                <span class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 font-semibold text-xs pointer-events-none">‚Ç¨/mois</span>
              </div>
            </div>

            <!-- Message d'erreur -->
            <p id="form-error" class="hidden mb-4 text-sm text-red-600 bg-red-50 border border-red-200 rounded-lg px-4 py-2.5">
              <span id="form-error-text">Merci de renseigner tous les champs obligatoires.</span>
            </p>

            <!-- Submit -->
            <button
              id="btn-estimate"
              type="button"
              class="w-full flex items-center justify-center gap-2 bg-primary text-primary-foreground hover:bg-primary/90 font-semibold rounded-xl px-6 py-3.5 text-sm transition-colors shadow-sm"
            >
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z" />
              </svg>
              Estimer l'impact
            </button>
          </div>

          <!-- ‚îÄ‚îÄ R√âSULTAT (masqu√© par d√©faut) ‚îÄ‚îÄ -->
          <div
            id="result"
            class="hidden bg-white rounded-2xl border border-slate-200 shadow-md overflow-hidden"
            aria-live="polite"
            aria-atomic="true"
          >
            <!-- Barre de couleur en haut -->
            <div id="result-top-bar" class="h-1.5 w-full bg-emerald-500 transition-colors duration-500"></div>

            <div class="p-6 sm:p-8 space-y-5">

              <!-- Verdict global -->
              <div class="flex items-center gap-3">
                <span id="result-emoji" class="text-3xl leading-none" aria-hidden="true">üü¢</span>
                <div>
                  <p class="text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-0.5">Impact estim√©</p>
                  <p id="result-verdict" class="text-xl font-black text-slate-900 leading-tight"></p>
                </div>
              </div>

              <!-- Valorisation patrimoniale -->
              <div class="p-4 rounded-xl bg-slate-50 border border-slate-100">
                <p class="text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-2">Valorisation estim√©e du bien</p>
                <div class="flex items-baseline justify-between gap-2 mb-3 flex-wrap">
                  <p id="result-range" class="text-2xl font-black tabular-nums text-slate-900 leading-tight"></p>
                  <p id="result-pct" class="text-base font-bold text-slate-500 tabular-nums"></p>
                </div>
                <div class="w-full h-2 bg-slate-200 rounded-full overflow-hidden">
                  <div
                    id="result-bar"
                    class="h-full rounded-full transition-all duration-700 ease-out bg-emerald-500"
                    style="width: 0%"
                  ></div>
                </div>
                <div class="flex justify-between text-[10px] text-slate-400 mt-1">
                  <span>0 %</span><span>50 %</span><span>100 %</span>
                </div>
              </div>

              <!-- Bloc impact locatif (Location seulement) -->
              <div id="result-rental" class="hidden p-5 rounded-xl bg-blue-50 border border-blue-200">
                <div class="flex items-center gap-2 mb-4">
                  <span class="text-lg" aria-hidden="true">üìà</span>
                  <p class="text-sm font-bold text-blue-800">Impact locatif estim√©</p>
                </div>

                <!-- Augmentation loyer -->
                <div class="flex items-start justify-between gap-3 mb-2">
                  <div>
                    <p class="text-xs font-semibold text-blue-700 mb-0.5">Augmentation estim√©e du loyer</p>
                    <p class="text-[11px] text-blue-500">Fourchette mensuelle selon le march√© local</p>
                  </div>
                  <p id="result-rent-range" class="text-base font-black text-blue-900 tabular-nums whitespace-nowrap flex-shrink-0"></p>
                </div>

                <!-- Gain rendement brut (si loyer actuel renseign√©) -->
                <div id="result-yield-block" class="hidden pt-3 border-t border-blue-200 mt-3">
                  <div class="flex items-start justify-between gap-3">
                    <div>
                      <p class="text-xs font-semibold text-blue-700 mb-0.5">Gain de rendement brut potentiel</p>
                      <p class="text-[11px] text-blue-500">(augmentation loyer √ó 12) / budget travaux</p>
                    </div>
                    <p id="result-yield" class="text-base font-black text-blue-900 tabular-nums whitespace-nowrap flex-shrink-0"></p>
                  </div>
                </div>

                <!-- Contexte zone/type -->
                <p id="result-rental-context" class="text-[11px] text-blue-500 mt-3 leading-relaxed italic"></p>
              </div>

              <!-- Message p√©dagogique -->
              <div id="result-message-box" class="rounded-xl border p-4 transition-colors duration-300">
                <p id="result-message-title-row" class="text-xs font-bold mb-1.5 flex items-center gap-1.5">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 001.5-.189m-1.5.189a6.01 6.01 0 01-1.5-.189m3.75 7.478a12.06 12.06 0 01-4.5 0m3.75 2.383a14.406 14.406 0 01-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 10-7.517 0c.85.493 1.509 1.333 1.509 2.316V18" />
                  </svg>
                  <span id="result-message-title">Pourquoi ce r√©sultat ?</span>
                </p>
                <p id="result-message" class="text-sm leading-relaxed"></p>
              </div>

              <!-- Avertissement -->
              <p class="text-xs text-slate-400 italic text-center leading-relaxed">
                Les r√©sultats d√©pendent du march√© local et de la qualit√© d'ex√©cution des travaux.
                Estimation indicative bas√©e sur des moyennes observ√©es.
              </p>

              <!-- CTA -->
              <a
                href="/nouvelle-analyse"
                class="w-full flex items-center justify-center gap-2 bg-slate-900 text-white hover:bg-slate-800 font-semibold rounded-xl px-6 py-3.5 text-sm transition-colors"
              >
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5" />
                </svg>
                Analyser mon devis pour une estimation d√©taill√©e
              </a>
              <p class="text-center text-xs text-slate-400 !mt-2">
                Gratuit ¬∑ Confidentiel ¬∑ R√©sultat en 2 minutes avec votre devis r√©el
              </p>

            </div>
          </div>

        </div>
      </section>

      <!-- ‚ïê‚ïê EXPLICATION + MAILLAGE ‚ïê‚ïê -->
      <section class="py-10 sm:py-12 border-t border-slate-200">
        <div class="container max-w-xl">
          <div class="mb-6">
            <p class="text-xs font-bold uppercase tracking-widest text-slate-400 mb-3">Comment fonctionne ce simulateur ?</p>
            <p class="text-sm text-slate-600 leading-relaxed mb-3">
              Ce simulateur applique des fourchettes de retour sur investissement moyennes
              observ√©es sur le march√© immobilier fran√ßais, par type de travaux, objectif et zone g√©ographique.
              Ces chiffres sont des <strong>ordres de grandeur</strong> ‚Äî ils ne remplacent pas
              une analyse bas√©e sur votre devis r√©el.
            </p>
            <p class="text-sm text-slate-600 leading-relaxed">
              Pour une estimation pr√©cise et personnalis√©e, d√©posez votre devis sur VerifierMonDevis.fr.
              Notre analyse inclut une comparaison prix march√© + l'Indice Strat√©gique Immobilier‚Ñ¢
              calcul√© √† partir des postes exacts de votre devis.
            </p>
          </div>
          <div class="flex flex-wrap gap-3 text-sm">
            <a href="/nouvelle-analyse" class="inline-flex items-center gap-1.5 bg-primary text-primary-foreground hover:bg-primary/90 px-4 py-2 rounded-lg font-medium transition-colors">
              Analyser mon devis
            </a>
            <a href="/valorisation-travaux-immobiliers" class="inline-flex items-center gap-1.5 border border-slate-300 text-slate-700 hover:bg-slate-50 px-4 py-2 rounded-lg transition-colors">
              Guide valorisation des travaux
            </a>
            <a href="/faq" class="inline-flex items-center gap-1.5 border border-slate-300 text-slate-700 hover:bg-slate-50 px-4 py-2 rounded-lg transition-colors">
              FAQ
            </a>
          </div>
        </div>
      </section>

    </main>

    <AstroFooter />
  </div>
</BaseLayout>

<!-- ‚ïê‚ïê LOGIQUE SIMULATEUR ‚ïê‚ïê -->
<script>
  // ‚îÄ‚îÄ Types ‚îÄ‚îÄ
  type WorkType     = 'extension' | 'renovation_complete' | 'cuisine_sdb' | 'isolation_energie' | 'rafraichissement';
  type Objective    = 'revente' | 'location';
  type ZoneType     = 'tendue' | 'intermediaire' | 'detendue';
  type PropertyType = 'appartement' | 'maison';

  // ‚îÄ‚îÄ Config valorisation patrimoniale ‚îÄ‚îÄ
  interface WorkConfig {
    min: number; max: number;
    verdict: string; emoji: string;
    barColor: string; topBarColor: string;
    msgBoxBg: string; msgBoxBorder: string;
    msgBoxTitle: string; msgBoxTextColor: string;
  }

  const CONFIG: Record<WorkType, Record<Objective, WorkConfig>> = {
    extension: {
      revente:  { min: 0.80, max: 0.95, verdict: "Forte valorisation",          emoji: "üü¢", barColor: "bg-emerald-500", topBarColor: "bg-emerald-500", msgBoxBg: "bg-emerald-50", msgBoxBorder: "border-emerald-200", msgBoxTitle: "Pourquoi un fort impact ?",          msgBoxTextColor: "text-emerald-800" },
      location: { min: 0.65, max: 0.80, verdict: "Forte valorisation",          emoji: "üü¢", barColor: "bg-emerald-500", topBarColor: "bg-emerald-500", msgBoxBg: "bg-emerald-50", msgBoxBorder: "border-emerald-200", msgBoxTitle: "Pourquoi un fort impact ?",          msgBoxTextColor: "text-emerald-800" },
    },
    renovation_complete: {
      revente:  { min: 0.65, max: 0.85, verdict: "Forte valorisation",          emoji: "üü¢", barColor: "bg-emerald-500", topBarColor: "bg-emerald-500", msgBoxBg: "bg-emerald-50", msgBoxBorder: "border-emerald-200", msgBoxTitle: "Pourquoi un fort impact ?",          msgBoxTextColor: "text-emerald-800" },
      location: { min: 0.55, max: 0.72, verdict: "Valorisation partielle",      emoji: "üü°", barColor: "bg-amber-400",   topBarColor: "bg-amber-400",   msgBoxBg: "bg-amber-50",   msgBoxBorder: "border-amber-200",   msgBoxTitle: "Ce qui fait varier l'impact",       msgBoxTextColor: "text-amber-800"   },
    },
    cuisine_sdb: {
      revente:  { min: 0.50, max: 0.75, verdict: "Valorisation partielle",      emoji: "üü°", barColor: "bg-amber-400",   topBarColor: "bg-amber-400",   msgBoxBg: "bg-amber-50",   msgBoxBorder: "border-amber-200",   msgBoxTitle: "Ce qui fait varier l'impact",       msgBoxTextColor: "text-amber-800"   },
      location: { min: 0.40, max: 0.60, verdict: "Valorisation partielle",      emoji: "üü°", barColor: "bg-amber-400",   topBarColor: "bg-amber-400",   msgBoxBg: "bg-amber-50",   msgBoxBorder: "border-amber-200",   msgBoxTitle: "Ce qui fait varier l'impact",       msgBoxTextColor: "text-amber-800"   },
    },
    isolation_energie: {
      revente:  { min: 0.55, max: 0.80, verdict: "Valorisation partielle √† forte", emoji: "üü°", barColor: "bg-amber-400", topBarColor: "bg-amber-400", msgBoxBg: "bg-amber-50", msgBoxBorder: "border-amber-200", msgBoxTitle: "L'effet DPE",                          msgBoxTextColor: "text-amber-800"   },
      location: { min: 0.55, max: 0.75, verdict: "Valorisation partielle √† forte", emoji: "üü°", barColor: "bg-amber-400", topBarColor: "bg-amber-400", msgBoxBg: "bg-amber-50", msgBoxBorder: "border-amber-200", msgBoxTitle: "L'effet DPE",                          msgBoxTextColor: "text-amber-800"   },
    },
    rafraichissement: {
      revente:  { min: 0.15, max: 0.35, verdict: "Impact limit√©",               emoji: "üî¥", barColor: "bg-red-400",    topBarColor: "bg-red-400",    msgBoxBg: "bg-red-50",    msgBoxBorder: "border-red-200",    msgBoxTitle: "Pourquoi l'impact est faible ?",    msgBoxTextColor: "text-red-800"     },
      location: { min: 0.10, max: 0.25, verdict: "Impact limit√©",               emoji: "üî¥", barColor: "bg-red-400",    topBarColor: "bg-red-400",    msgBoxBg: "bg-red-50",    msgBoxBorder: "border-red-200",    msgBoxTitle: "Pourquoi l'impact est faible ?",    msgBoxTextColor: "text-red-800"     },
    },
  };

  // ‚îÄ‚îÄ Config impact locatif : augmentation loyer par zone ‚îÄ‚îÄ
  const RENT_DELTA: Record<WorkType, Record<ZoneType, { min: number; max: number }>> = {
    extension: {
      tendue:        { min: 120, max: 250 },
      intermediaire: { min: 70,  max: 150 },
      detendue:      { min: 30,  max: 80  },
    },
    renovation_complete: {
      tendue:        { min: 80,  max: 180 },
      intermediaire: { min: 50,  max: 120 },
      detendue:      { min: 20,  max: 70  },
    },
    cuisine_sdb: {
      tendue:        { min: 50,  max: 120 },
      intermediaire: { min: 30,  max: 80  },
      detendue:      { min: 10,  max: 40  },
    },
    isolation_energie: {
      tendue:        { min: 30,  max: 80  },
      intermediaire: { min: 20,  max: 50  },
      detendue:      { min: 0,   max: 30  },
    },
    rafraichissement: {
      tendue:        { min: 0,   max: 20  },
      intermediaire: { min: 0,   max: 10  },
      detendue:      { min: 0,   max: 5   },
    },
  };

  // ‚îÄ‚îÄ Labels lisibles ‚îÄ‚îÄ
  const ZONE_LABELS: Record<ZoneType, string> = {
    tendue:        "zone tendue",
    intermediaire: "zone interm√©diaire",
    detendue:      "zone d√©tendue",
  };

  // ‚îÄ‚îÄ Messages p√©dagogiques ‚îÄ‚îÄ
  const MESSAGES: Record<WorkType, Record<Objective, string>> = {
    extension: {
      revente:  "Une extension cr√©e de la surface habitable ‚Äî c'est l'un des meilleurs leviers de valorisation. Les acheteurs paient au m¬≤, et chaque m¬≤ suppl√©mentaire est valoris√© au prix du march√© local. L'impact est d'autant plus fort que le march√© est tendu.",
      location: "Une extension augmente la surface louable et peut justifier un loyer plus √©lev√©. Dans les march√©s o√π la surface est rare, l'impact sur le loyer peut √™tre sup√©rieur √† la fourchette estim√©e.",
    },
    renovation_complete: {
      revente:  "Une r√©novation compl√®te rassure les acheteurs et r√©duit leur perception de risque. Elle permet de se positionner dans la fourchette haute du march√© local ‚Äî √† condition que l'investissement reste coh√©rent avec le plafond de prix du quartier.",
      location: "Un bien enti√®rement r√©nov√© attire des locataires plus stables et peut justifier un loyer sup√©rieur. Attention au plafond de march√© : dans certains secteurs, le loyer ne refl√®te pas le co√ªt r√©el d'une r√©novation haut de gamme.",
    },
    cuisine_sdb: {
      revente:  "La cuisine et la salle de bain sont les deux pi√®ces les plus scrut√©es lors d'une visite. L'impact est fort si elles √©taient v√©tustes, plus mod√©r√© si elles √©taient fonctionnelles. Une cuisine sobre et neutre attire davantage d'acheteurs.",
      location: "Une cuisine et une SDB r√©nov√©es r√©duisent la vacance et am√©liorent l'attractivit√© du bien. L'impact sur le loyer reste mod√©r√© et d√©pend du segment de march√© vis√©.",
    },
    isolation_energie: {
      revente:  "Le DPE est devenu un crit√®re d'achat d√©terminant depuis 2023. Un logement class√© F ou G subit une d√©cote de 5 √† 15 % selon les march√©s. Passer √† la classe C ou D peut g√©n√©rer une revalorisation significative, parfois sup√©rieure au co√ªt des travaux.",
      location: "Une bonne √©tiquette √©nerg√©tique est de plus en plus exig√©e par les locataires ‚Äî et impos√©e par la loi pour les passoires thermiques. L'impact sur la mise en location et le niveau de loyer peut d√©passer la fourchette estim√©e selon votre situation.",
    },
    rafraichissement: {
      revente:  "Le rafra√Æchissement am√©liore la premi√®re impression lors des visites, mais les acheteurs repeignent selon leurs propres go√ªts. L'impact sur le prix de vente reste faible (1 √† 3 %). Ces travaux sont utiles pour votre confort, pas pour la revente.",
      location: "L'impact sur le loyer est limit√©. Les locataires cherchent avant tout la fonctionnalit√©, le DPE et la localisation. Le rafra√Æchissement peut r√©duire la vacance marginalement mais ne justifie pas un loyer significativement plus √©lev√©.",
    },
  };

  // ‚îÄ‚îÄ √âtat ‚îÄ‚îÄ
  let selectedObjective: Objective = 'revente';

  // ‚îÄ‚îÄ Utilitaires ‚îÄ‚îÄ
  function formatEuro(n: number): string {
    return new Intl.NumberFormat('fr-FR', { style: 'currency', currency: 'EUR', maximumFractionDigits: 0 }).format(n);
  }

  function formatPct(n: number, decimals = 1): string {
    return n.toFixed(decimals).replace('.', ',');
  }

  function el<T extends HTMLElement>(id: string): T {
    return document.getElementById(id) as T;
  }

  // ‚îÄ‚îÄ Toggle objectif ‚îÄ‚îÄ
  function setObjective(obj: Objective) {
    selectedObjective = obj;
    const btnRevente  = el<HTMLButtonElement>('btn-revente');
    const btnLocation = el<HTMLButtonElement>('btn-location');
    const rentField   = el('rent-field');

    const active   = ['border-primary', 'bg-primary/5', 'text-primary', 'border-2'];
    const inactive = ['border-slate-200', 'bg-slate-50', 'text-slate-500'];

    if (obj === 'revente') {
      active.forEach(c => btnRevente.classList.add(c));
      inactive.forEach(c => btnRevente.classList.remove(c));
      inactive.forEach(c => btnLocation.classList.add(c));
      active.forEach(c => btnLocation.classList.remove(c));
      rentField.classList.add('hidden');
    } else {
      active.forEach(c => btnLocation.classList.add(c));
      inactive.forEach(c => btnLocation.classList.remove(c));
      inactive.forEach(c => btnRevente.classList.add(c));
      active.forEach(c => btnRevente.classList.remove(c));
      rentField.classList.remove('hidden');
    }
  }

  // ‚îÄ‚îÄ Calcul + affichage ‚îÄ‚îÄ
  function estimate() {
    const budgetInput    = el<HTMLInputElement>('budget');
    const workTypeEl     = el<HTMLSelectElement>('work-type');
    const zoneEl         = el<HTMLSelectElement>('location-zone');
    const propertyTypeEl = el<HTMLSelectElement>('property-type');
    const currentRentEl  = el<HTMLInputElement>('current-rent');
    const errorEl        = el('form-error');
    const errorTextEl    = el('form-error-text');

    const budget      = parseFloat(budgetInput.value);
    const workType    = workTypeEl.value    as WorkType;
    const zone        = zoneEl.value        as ZoneType | '';
    const propertyType = propertyTypeEl.value as PropertyType | '';
    const currentRent = parseFloat(currentRentEl.value) || 0;

    // ‚îÄ‚îÄ Validation ‚îÄ‚îÄ
    if (!budget || budget < 1000 || !workType) {
      errorTextEl.textContent = 'Merci de renseigner un budget (min. 1 000 ‚Ç¨) et un type de travaux.';
      errorEl.classList.remove('hidden');
      budgetInput.focus();
      return;
    }
    if (!zone || !propertyType) {
      errorTextEl.textContent = 'Merci de s√©lectionner la zone de march√© et le type de bien.';
      errorEl.classList.remove('hidden');
      zoneEl.focus();
      return;
    }
    errorEl.classList.add('hidden');

    // ‚îÄ‚îÄ Valorisation patrimoniale ‚îÄ‚îÄ
    const cfg    = CONFIG[workType][selectedObjective];
    const valMin = Math.round(budget * cfg.min);
    const valMax = Math.round(budget * cfg.max);
    const avgPct = Math.round(((cfg.min + cfg.max) / 2) * 100);

    el('result-emoji').textContent   = cfg.emoji;
    el('result-verdict').textContent = cfg.verdict;
    el('result-range').textContent   = `Entre ${formatEuro(valMin)} et ${formatEuro(valMax)}`;
    el('result-pct').textContent     = `${Math.round(cfg.min * 100)} ‚Äì ${Math.round(cfg.max * 100)} %`;

    const bar = el('result-bar');
    bar.className = `h-full rounded-full transition-all duration-700 ease-out ${cfg.barColor}`;
    setTimeout(() => { bar.style.width = `${Math.min(avgPct, 100)}%`; }, 50);

    el('result-top-bar').className = `h-1.5 w-full transition-colors duration-500 ${cfg.topBarColor}`;

    // ‚îÄ‚îÄ Message p√©dagogique ‚îÄ‚îÄ
    const msgBox      = el('result-message-box');
    const msgTitleRow = el('result-message-title-row');
    const msgTitleSpan = el('result-message-title');
    const msgText     = el('result-message');
    msgBox.className      = `rounded-xl border p-4 transition-colors duration-300 ${cfg.msgBoxBg} ${cfg.msgBoxBorder}`;
    msgTitleRow.className = `text-xs font-bold mb-1.5 flex items-center gap-1.5 ${cfg.msgBoxTextColor}`;
    msgTitleSpan.textContent = cfg.msgBoxTitle;
    msgText.className     = `text-sm leading-relaxed ${cfg.msgBoxTextColor}`;
    msgText.textContent   = MESSAGES[workType][selectedObjective];

    // ‚îÄ‚îÄ Impact locatif (Location uniquement) ‚îÄ‚îÄ
    const rentalBlock  = el('result-rental');
    const yieldBlock   = el('result-yield-block');
    const rentalCtx    = el('result-rental-context');

    if (selectedObjective === 'location') {
      const delta = RENT_DELTA[workType][zone as ZoneType];

      // Augmentation loyer
      const rentMin = delta.min;
      const rentMax = delta.max;
      el('result-rent-range').textContent = rentMax > 0
        ? `+${rentMin} √† +${rentMax} ‚Ç¨/mois`
        : 'Impact n√©gligeable';

      // Contexte
      const propLabel = propertyType === 'appartement' ? 'appartement' : 'maison';
      rentalCtx.textContent =
        `Estimation pour un ${propLabel} en ${ZONE_LABELS[zone as ZoneType]}.`;

      // Gain rendement brut (si loyer actuel renseign√© et > 0)
      if (currentRent > 0 && budget > 0 && rentMax > 0) {
        const avgRentDelta = (rentMin + rentMax) / 2;
        const yieldGainMin = (rentMin  * 12 / budget) * 100;
        const yieldGainMax = (rentMax  * 12 / budget) * 100;
        // Anti-NaN : budget > 0 garanti par validation
        el('result-yield').textContent =
          `+${formatPct(yieldGainMin)} √† +${formatPct(yieldGainMax)} %`;
        yieldBlock.classList.remove('hidden');
      } else {
        yieldBlock.classList.add('hidden');
      }

      rentalBlock.classList.remove('hidden');
    } else {
      rentalBlock.classList.add('hidden');
      yieldBlock.classList.add('hidden');
    }

    // ‚îÄ‚îÄ Affichage du bloc r√©sultat ‚îÄ‚îÄ
    const result = el('result');
    result.classList.remove('hidden');
    setTimeout(() => {
      result.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }, 100);
  }

  // ‚îÄ‚îÄ Listeners ‚îÄ‚îÄ
  el('btn-revente')?.addEventListener('click',  () => setObjective('revente'));
  el('btn-location')?.addEventListener('click', () => setObjective('location'));
  el('btn-estimate')?.addEventListener('click', estimate);
  el<HTMLInputElement>('budget')?.addEventListener('keydown', (e) => {
    if ((e as KeyboardEvent).key === 'Enter') estimate();
  });
</script>
